<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cassiopeia A</title>

    <!-- load stylesheet -->
    <link href="../../style.css" rel="stylesheet">
    
    <!-- load A-frame code -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.2.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-curve-component/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://unpkg.com/aframe-render-order-component@1.1.0/dist/aframe-render-order-component.min.js"></script>

    <!-- load general tour code -->  
    <script type="text/javascript" src="../../tourScripts/index.js"></script>
    <script type="text/javascript" src="../../tourScripts/tour.js"></script>
    <script type="text/javascript" src="../../tourScripts/lookat.js"></script>
    <script type="text/javascript" src="../../tourScripts/controller.js"></script>

    <!-- load any custom components/materials -->
    <script type="text/javascript" src="../../materials/transparent-edge-material.js"></script>
  </head>
  <body>
    <a-scene id="mainScene"
      background="color: #000000"
      render-order="background, nebula, text">
      >

      <!-- load gltf models, audio, and images here -->
    	<a-assets>
        <!-- <a-asset-item id="ejecta" src="../../gltf/ic443_ejecta.glb"></a-asset-item>
        <a-asset-item id="blastwave" src="../../gltf/ic443_blastwave.glb"></a-asset-item> -->
        <a-asset-item id="cco" src="../../gltf/cassiopeia_cco.glb"></a-asset-item>
        <a-asset-item id="fekcorr" src="../../gltf/cassiopeia_fekcorr.glb"></a-asset-item>
        <a-asset-item id="newar" src="../../gltf/cassiopeia_newar.glb"></a-asset-item>
        <a-asset-item id="newhetg" src="../../gltf/cassiopeia_newhetg.glb"></a-asset-item>
        <a-asset-item id="newjets" src="../../gltf/cassiopeia_newjets.glb"></a-asset-item>
        <a-asset-item id="newopt" src="../../gltf/cassiopeia_newopt.glb"></a-asset-item>
        <a-asset-item id="newsi-ascii" src="../../gltf/cassiopeia_newsi-ascii.glb"></a-asset-item>
        <a-asset-item id="inner_shockwave" src="../../gltf/cassiopeia_inner_shockwave.glb"></a-asset-item>
        <a-asset-item id="outer_shockwave" src="../../gltf/cassiopeia_outer_shockwave.glb"></a-asset-item>

        <img id="deepspace" src="../../textures/deepspace.png">
        <audio id="iron" src="./audio/Iron_Xray_AJ.wav" preload="auto"></audio>
        <audio id="neutron" src="./audio/NeutronStar_AJ.wav" preload="auto"></audio>
        <audio id="jets" src="./audio/Jets_AJ.wav" preload="auto"></audio>
        <audio id="acceleration" src="./audio/Acceleration_AJ.wav" preload="auto"></audio>
        <audio id="infrared" src="./audio/Infrared_AJ.wav" preload="auto"></audio>
        <audio id="outerblast_xray" src="./audio/OuterBlast_Xray_AJ.wav" preload="auto"></audio>
        <audio id="outerblast_opt" src="./audio/OuterBlast_Opt_IR_AJ.wav" preload="auto"></audio>
    	</a-assets>

  
      <!-- add and edit tour stops and camera movements here -->
      <a-entity id="rig" rotation="0 0 0" position="0 0 0" wasd-controls look-controls="pointerLockEnabled: true" alongpath="curve: #two; dur: 5000">
        <a-entity id="camera" camera="active: true" position="0 0 0"></a-entity>
        <a-entity id="controllerElement" controller sound="autoplay: false; volume: 0.75">
          <!-- naming convention: all lower case -->
          <!-- <a-curve id="one" tour="dur: 3000; pauseDuration: 2000; text: You are looking at data from the Cassiopeia A supernova. 
          Click anywhere on the screen to orbit the data and see it from all angles. Clicking will move you along to another stop on the tour.">
            <a-curve-point position="2.8 -0.5 -5.5"></a-curve-point>
            <a-curve-point position="2.8 5.4 -.5"></a-curve-point>
            <a-curve-point position="0.7 -0.5 7.7"></a-curve-point>
          new coordinates
          </a-curve> -->
          <!-- <a-curve id="two" tour="dur: 10000; pauseDuration: 7000; audio: neutron; text: At the center of Cas A is a neutron star, a small ultra-dense star created by the supernova.">
            <a-curve-point position="2.8 -0.5 -5.5"></a-curve-point>
            <a-curve-point position="2.8 5.4 -.5"></a-curve-point>
            <a-curve-point position="0.7 -0.5 7.7"></a-curve-point>
          </a-curve> -->

          <!-- testing coordinates -->
          <a-curve id="two" tour="dur: 10000; pauseDuration: 7000; audio: neutron; text: At the center of Cas A is a neutron star, a small ultra-dense star created by the supernova.">
            <a-curve-point position="10 0 100"></a-curve-point>
            <a-curve-point position="0 8 30"></a-curve-point>
            <a-curve-point position="-3.1 0 -1"></a-curve-point>
          </a-curve>

          <!-- testing coordinates for fek -->
          <a-curve id="three" tour="dur: 19000; pauseDuration: 16000; audio: iron; text: Fek (Chandra Telescope): 
          The light blue portions of this model represent radiation from the element iron
          as seen in X-ray light from Chandra. Iron is forged in the very core of the star but ends up on the outside of the expanding ring of debris.">
            <a-curve-point position="-3.1 0 -1"></a-curve-point>
            <a-curve-point position="-30 3 40"></a-curve-point>
          </a-curve>

          <!-- testing coordinates for jets -->
          <a-curve id="four" tour="dur: 13000; pauseDuration: 10000; audio: jets; text: Fiducial Jets: In green, two jets of material are seen.
          These jets funnel material and energy during and after the explosion.">
            <a-curve-point position="-30 3 40"></a-curve-point>
            <a-curve-point position="0 0 20"></a-curve-point>
            <a-curve-point position="40 25 10"></a-curve-point>
          </a-curve>

          <!-- testing coordinates for shock sphere -->
          <a-curve id="five" tour="dur: 21000; pauseDuration: 18000; audio: acceleration; text: Reverse Shock Sphere: 
        The Cas A supernova remnant acts like a relativistic pinball machine by accelerating electrons to enormous energies. 
        This area shows where the acceleration is taking place in an expanding shock wave generated by the explosion.">
            <a-curve-point position="40 25 10"></a-curve-point>
            <a-curve-point position="-40 0 100"></a-curve-point>
            <a-curve-point position="10 0 100"></a-curve-point>
          </a-curve>

          <!-- testing coordinates for infrared (newar) -->
          <a-curve id="six" tour="dur: 16000; pauseDuration: 13000; audio: infrared; text: ArII Spitzer Telescope:
          The yellow portions of the model represent infrared data from the Spitzer Space Telescope. 
          This is cooler debris that has yet to be superheated by a passing shockwave.">
            <a-curve-point position="10 0 100"></a-curve-point>
            <a-curve-point position="-20 0 50"></a-curve-point>
            <a-curve-point position="20 0 50"></a-curve-point>
            <a-curve-point position="0 0 50"></a-curve-point>
          </a-curve>


          <a-curve id="seven" tour="dur: 14000; pauseDuration: 10000; audio: outerblast_xray; text: Si Chandra Telescope:
          The dark blue colored elements of the model represent the outer blask wave of the explosion as seen in X-rays by Chandra.">
            <a-curve-point position="0.7 -0.6 4.3"></a-curve-point>
            <a-curve-point position="-0.6 4.4 -0.4"></a-curve-point>
            <a-curve-point position="2.8 -0.5 -5.5"></a-curve-point>
          </a-curve>
          <a-curve id="eight" tour="dur: 14000; pauseDuration: 11000; audio: outerblast_opt; text: Outer Knots:
          The red colored elements of the model represent an outer blast wave of the explosion as seen in optical and infrared light, much of which is silicon.">
            <a-curve-point position="0.7 -0.6 4.3"></a-curve-point>
            <a-curve-point position="-0.6 4.4 -0.4"></a-curve-point>
            <a-curve-point position="2.8 -0.5 -5.5"></a-curve-point>
          </a-curve>
          <!-- We usually include one last stop on the tour as a vantage point -->
          <!-- This last camera animation is also shown during the splash screen while the objects are loading -->
          <a-curve id="nine" tour="dur: 15000; pauseDuration: 8000; text: ">
            <a-curve-point position="2.8 -0.5 -5.5"></a-curve-point>
            <a-curve-point position="2.8 5.4 -.5"></a-curve-point>
            <a-curve-point position="0.7 -0.5 7.7"></a-curve-point>
          </a-curve>
        </a-entity>
      </a-entity>

      <!-- place objects in the scene -->

      <a-sky src="#deepspace" render-order="background"></a-sky>

      <!-- the tour text is initially filled with a large amount of text and placed out of view, -->
      <!-- since the text bounding box is apparently set from the size of the initial text -->
      <a-entity id="textHolder"
                    position="0 0 1000"
                    look-at="[camera]"
                    render-order="text"
                    text="width: 1; color: white; align: center;
                          anchor: center; side: double;
                          value:  welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! welcome! ">
      </a-entity>

      <!-- Adding GLTF models for Cas A -->
      <a-entity
     id="Cassiopeia"
     scale="1 1 1"
     position="0 0 0"
     rotation="0 0 0">

     <a-entity
         id="cco"
         gltf-model="#cco"
         renderer="antialias: true;
         colorManagement: true;"
         render-order="nebula"
         >
     </a-entity>

     <a-entity
          id="fekcorr"
          gltf-model="#fekcorr"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material
          >
     </a-entity>
 
     <a-entity
         id="newar"
         gltf-model="#newar"
         renderer="antialias: true;
         colorManagement: true;"
         render-order="nebula"
         transparent-edge-material
         >
     </a-entity>
     
     <a-entity
         id="newhetg"
         gltf-model="#newhetg"
         renderer="antialias: true;
         colorManagement: true;"
         render-order="nebula"
         transparent-edge-material
         >
     </a-entity>

     <a-entity
          id="newjets"
          gltf-model="#newjets"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material
          >
      </a-entity>

      <a-entity
          id="newopt"
          gltf-model="#newopt"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material
          >
      </a-entity>

      <a-entity
          id="newsi-ascii"
          gltf-model="#newsi-ascii"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material = "saturation: 0.5"
          >
      </a-entity>


      <a-entity
        id="inner_shockwave"
        gltf-model="#inner_shockwave"
        renderer="antialias: true;
        colorManagement: true;"
        render-order="nebula"
        transparent-edge-material = "opaqueAngle: 4.0;
        transparentAngle: 0.0;
        ">
      </a-entity>

      <a-entity
        id="outer_shockwave"
        gltf-model="#outer_shockwave"
        renderer="antialias: true;
        colorManagement: true;"
        render-order="nebula"
        transparent-edge-material = "opaqueAngle: 0.0;
        transparentAngle: 0.4;
        ">       
      </a-entity>

 </a-entity>

       <!-- Adding GLTF models for IC-443 -->
      <!-- <a-entity
        id="IC-443"
        scale="1 1 1"
        position="0 0 0"
        rotation="0 0 0">
        <a-entity
          id="Ejecta"
          gltf-model="#ejecta"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material="
            opaqueAngle: 1.0;
            transparentAngle: 0.5;
          ">
        </a-entity>
        <a-entity
          id="Blast Wave"
          gltf-model="#blastwave"
          renderer="antialias: true;
          colorManagement: true;"
          render-order="nebula"
          transparent-edge-material="
            opaqueAngle: -0.2;
            transparentAngle: 0.5;
          ">
        </a-entity>
      </a-entity> -->
    </a-scene>
    
    <div id="splash">
      <div id="splash-inner">
        <div class="title">Cassiopeia A</div>
        <div id="go-button" onclick="pressStart()" style="display: none;">Start</div>
        <div class="sub-title">VR by <a href="https://www.nasa.gov/">NASA</a>,
        <a href="http://chandra.harvard.edu/">Chandra</a>, <br>
        <a href="https://www.cfa.harvard.edu/sao">SAO</a> &
        <a href="http://cs.brown.edu/people/faculty/tsgouros/">Brown CS</a></div>
        <br />
      </div>
    </div>

    <script type="text/javascript">
    // This stuff is down here at the end because it has to run as soon as
    // all the a-frame assets are loaded.  It manages the splash screen shown
    // above, by pausing the action as soon as everything is loaded, and then by
    // executing .play() when the start button is pressed.

    // Pause action as soon as everything is loaded.
    document.getElementById("mainScene").addEventListener("loaded",
      function() {
        document.getElementById("go-button").style.display = "flex";
    });

    pressStart = function() {
      document.getElementById("splash").style.display = "none";
      document.getElementById("go-button").style.display = "none";

      // Load all the sounds and play-then-pause them all, to get them
      // permission to run under the iOS rules, which say that a sound
      // can only be played as a result of a user action.
      var sounds = document.getElementsByTagName('audio');

      for (i = 0; i < sounds.length; i++) {
        // console.log("playing, then pausing:", sounds[i]);
        var promise = sounds[i].play(); 

        if (promise) {
            //console.log("PLAYING:", promise);
            sounds[i].pause();
            sounds[i].currentTime = 0;

          promise.catch(function(e) { 
            console.log(e); 
            console.log(e.name); 
            console.log(e.message); 
            console.log(e.code); 
          });
        }      
      }

      var controllerComponent = document.querySelector('[controller]').components.controller;;
      controllerComponent.startTour();
    }
  </script>

  </body>
</html>